<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hi_decklink_ros2: hi_decklink_ros2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">hi_decklink_ros2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">hi_decklink_ros2 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2mhenkel_2_documents_2hi__decklink__ros2_2_r_e_a_d_m_e"></a> <a href="https://atlas.is.localnet/bamboo/browse/BAMEI-CIT/latest/"><img src="https://raw.githubusercontent.com/MPI-IS-BambooAgent/sw_badges/master/badges/plans/hidecklinkros/build.svg?sanitize=true" alt="Build status" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
HI DeckLink ROS</h1>
<p>The <b>HI <a class="el" href="namespace_deck_link.html">DeckLink</a> ROS</b> package exposes BlackMagic Design <a class="el" href="namespace_deck_link.html">DeckLink</a> video playback and capture cards to a ROS network. It is based on the previous version <a href="https://gitlab.com/Polimi-dVRK/decklink/decklink_ros">DeckLink ROS</a> developed at the NearLab (Politecnico di Milano).</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Dependencies</h2>
<p><b>HI <a class="el" href="namespace_deck_link.html">DeckLink</a> ROS</b> leverages <a href="https://gitlab.com/Polimi-dVRK/decklink/libdecklink">libdecklink</a>, a higher-level level interface to the BlackMagic Design SDK, to control the underlying card(s). This component is installed as a git submodule.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Installation</h2>
<p>This project has been tested with:</p><ul>
<li>Ubuntu 16.04 and Ubuntu 20.04</li>
<li>ROS Kinetic, ROS Lunar, and ROS Noetic</li>
<li><a class="el" href="namespace_deck_link.html">DeckLink</a> Duo and <a class="el" href="namespace_deck_link.html">DeckLink</a> Quad 2</li>
</ul>
<p>Clone the repository into your ROS workspace: </p><pre class="fragment">git clone --recursive https://github.com/MPI-IS/hi_decklink_ros.git
</pre><p> Build the nodes: </p><pre class="fragment">catkin build hi_decklink_ros
</pre> <h2><a class="anchor" id="autotoc_md3"></a>
Docker</h2>
<p><b>HI <a class="el" href="namespace_deck_link.html">DeckLink</a> ROS</b> can also be built inside a Docker container using the provided <code>Dockerfile</code>. In order to do so, simply do</p>
<div class="fragment"><div class="line">docker build . -t hi_declink_ros # builds image</div>
<div class="line">docker run -it -d --name my_container hi_declink_ros # starts container</div>
</div><!-- fragment --><p>Note that building this image is part of our continuous integration.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
The publisher node</h2>
<p>The publisher node reads images from one input of the <a class="el" href="namespace_deck_link.html">DeckLink</a> card and publishes them to ROS topic. After having the <code>roscore</code> running, open in a different terminal: </p><pre class="fragment">rosrun hi_decklink_ros publisher _decklink_device:="DeckLink [model] ([input])"
</pre><p> This will create a <code>publisher</code> node that listens for images on from one input of your <a class="el" href="namespace_deck_link.html">DeckLink</a> card and publishes them on the topic <code>/image_raw</code>.</p>
<p>To see the published image: </p><pre class="fragment">rosrun image_view image_view image:="image_raw"
</pre><p> The node will additionally publish <code>sensor_msgs::CameraInfo</code> messages synchronised to each image message. If the camera is uncalibrated these will be empty. If a camera calibration file is available you can pass the path to the file in the <code>camera_info_url</code> parameter. This will allow the <code>image_proc</code> family of nodes to automatically generate rectified images.</p>
<p>The node accepts the following parameters:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>decklink_device</code>   </td><td class="markdownTableBodyNone">The name of the capture (input) interface on the <a class="el" href="namespace_deck_link.html">DeckLink</a> card from which to read images and the channel used.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>camera_name</code>   </td><td class="markdownTableBodyNone">A name to identify the camera. The name is used to check that the right camera calibration information is being used. If the camera name in the calibration file and the name passed here differ a warning will be shown in the ROS console. If the name is not set the <a class="el" href="namespace_deck_link.html">DeckLink</a> device name is used instead.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>camera_frame</code>   </td><td class="markdownTableBodyNone">The <code>tf</code> frame that the camera should attached to. This helps to keep point clouds generated with <code>stereo_image_proc</code> in the correct reference frame. The default value is the camera name.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>camera_info_url</code>   </td><td class="markdownTableBodyNone">The location in which to locate the camera info file. This should a be an absolute file path.   </td></tr>
</table>
<p>A launch file for a stereo endoscope is provided for documentation purposes in the <code>launch/</code> folder.</p>
<p>The publisher node has been tested on:</p><ul>
<li>a clinical Intuitive da Vinci Si HD robotic system</li>
<li>a dVRK (da Vinci Research Kit)</li>
<li>a standard HD-SDI video camera</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
The subscriber node</h2>
<p>The subscriber node reads images from a ROS topic and writes them to the specified <a class="el" href="namespace_deck_link.html">DeckLink</a> output. This node can be used to perform keying.</p>
<p>After having the <code>roscore</code> running, open in a different terminal: </p><pre class="fragment">rosrun hi_decklink_ros subscriber _decklink_device:="DeckLink [model] ([input])" _topic:="[ros/image/topic]"
</pre><p> This will create a <code>subscriber</code> node that monitors the ROS image topic given as input. This node expects <code>BGRA8</code> formatted images for simplicity and will produce an error if an image with a different formatting is used. The alpha channel is required to support keying. To quickly test this node, please check the section "Test subscriber".</p>
<p>The node accepts the following parameters:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>decklink_device</code>   </td><td class="markdownTableBodyNone">The name of the playback (output) interface on the <a class="el" href="namespace_deck_link.html">DeckLink</a> card onto which the images will be written and the channel used.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>topic</code>   </td><td class="markdownTableBodyNone">The ROS topic from which the images will be read.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>image_format</code>   </td><td class="markdownTableBodyNone">The name of the display mode to use.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>keying (bool)</code>   </td><td class="markdownTableBodyNone">Whether or not to enable keying on the card.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>opacity (int)</code>   </td><td class="markdownTableBodyNone">The opacity of the keyed images in the range 0 (transparent) to 255 (opaque).   </td></tr>
</table>
<p>The subscriber node has been tested on:</p><ul>
<li>the stereo viewer of a clinical Intuitive da Vinci Si HD robotic system</li>
<li>the stereo viewer of a dVRK (da Vinci Research Kit)</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Using keying</h2>
<p>Keying on <a class="el" href="namespace_deck_link.html">DeckLink</a> devices is extremely fast (less than 1ms extra latency on average). On modern cards it is possible to re-map each individual connector so that they can be used individually for input or for output. However, to use keying you must provide an input onto which the images will be keyed; as such, you must retain a pair (the left connector is for input and the right connector is for output). The output will be the input video with the keyed image overlaid on top with the specified opacity.</p>
<p>The pixel format is hard coded to YUV422.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Test subscriber</h2>
<p>We prepared a small demo to test the subscriber node both in writing and keying mode. We placed an image (<code>image.png</code> in the folder <code>sample</code>) that you are welcome to use.</p>
<p>After having the <code>roscore</code> running: </p><pre class="fragment">rosrun hi_decklink_ros img2ros _path:="[/path/to/your/image.png]"
</pre><p> This will create a ROS topic image (<code>image_ros</code>). You can see it with: </p><pre class="fragment">rosrun image_view image_view image:="image_ros"
</pre><p> Then run the subscriber node, specifying this topic: </p><pre class="fragment">rosrun hi_decklink_ros subscriber _decklink_device:="DeckLink [model] ([input])" _topic:="image_ros"
</pre><p> By default, the node will write this image.</p>
<p>If you want this image to be keyed on the input video: </p><pre class="fragment">rosrun hi_decklink_ros subscriber _decklink_device:="DeckLink [model] ([input])" _topic:="image_ros" _keying:="True" _opacity:="150"
</pre><p> We designed the subscriber node, in a way that it possible to use the same node and change the two modes (write/keying) internally, using a boolean topic <code>function/output_write</code>. To understand its functioning, we suggest to check it in <code>subscriber.cpp</code>.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Launch examples</h2>
<p>We used these drivers to connect a workstation computer to the vision system of a clinical da Vinci Si HD surgical robot (Intuitive Inc.). In this way, we could overlay virtual content of the intraoperative images acquired by the endoscope.</p>
<p>Examples of launch files are in the folder <code>launch</code>. For more information about how to connect the hardware to a da Vinci robot, please refer to our paper.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Authors</h2>
<p><a href="https://is.mpg.de/person/Forte">Maria-Paola Forte</a>, Haptic Intelligence Department - Max Planck Institute for Intelligent Systems</p>
<p><a href="https://www.linkedin.com/in/thibaudchupin/">Thibaud Chupin</a></p>
<p><b>HI <a class="el" href="namespace_deck_link.html">DeckLink</a> ROS</b> is based on the work done by <a href="https://www.linkedin.com/in/thibaudchupin/">Thibaud Chupin</a> on <a href="https://gitlab.com/Polimi-dVRK/decklink/decklink_ros">DeckLink ROS</a>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Maintainers</h2>
<p><a href="https://is.mpg.de/person/Forte">Maria-Paola Forte</a>, Haptic Intelligence Department - Max Planck Institute for Intelligent Systems</p>
<h2><a class="anchor" id="autotoc_md11"></a>
License</h2>
<p>MIT license (see LICENSE.md).</p>
<p><a href="https://gitlab.com/Polimi-dVRK/decklink/decklink_ros">DeckLink ROS</a> is distributed under the MIT license (see LICENSE_declink_ros.md)</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Copyright</h2>
<p>© 2020, Max Planck Society - Max Planck Institute for Intelligent Systems</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Notes</h2>
<p>The <code>libdecklink</code> tools (check the status of the <a class="el" href="namespace_deck_link.html">DeckLink</a> card, its model, the status of the channels etc.) are not maintained anymore since this information can be obtained through the softwares provided by BlackMagic Design.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Acknowledgments</h2>
<p>We thank <a href="https://github.com/jcpassy">Jean-Claude Passy</a> and the <a href="http://is.tuebingen.mpg.de/en/software-workshop">Software Workshop</a> for their help to release the code.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Reference</h2>
<p>If you use these drivers, please cite: </p><div class="fragment"><div class="line">@article{Forte22-IJMRCAS-Design,</div>
<div class="line">  title={Design of Interactive {AR} Functions for Robotic Surgery and Evaluation in Dry-Lab Lymphadenectomy},</div>
<div class="line">  author={Forte, Maria-Paola and Gourishetti, Ravali and Javot, Bernard and Gomez, Ernest T. and Kuchenbecker, Katherine J.},</div>
<div class="line">  journal={The International Journal of Medical Robotics and Computer Assisted Surgery},</div>
<div class="line">  year={2022},</div>
<div class="line">  publisher={Wiley Online Library}</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
